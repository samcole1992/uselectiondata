<!DOCTYPE html>
<head>
<meta charset="utf-8">
<div id="tooltip"></div>

<svg width="960" height="600" id="statesvg"></svg>
<script src="uStates.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<style>
.state{
  fill: none;
  stroke: #a9a9a9;
  stroke-width: 1;
}
.state:hover{
  fill-opacity:0.5;
}
#mapTitle{
text-align: center;
font-family: 'Neuton', serif;
letter-spacing: 2px;
font-size: 50px;
}
#tooltip {
  position: absolute;
  text-align: center;
  padding: 20px;
  margin: 10px;
  font: 12px sans-serif;
  background: lightsteelblue;
  border: 1px;
  border-radius: 2px;
  pointer-events: none;
}
#tooltip h4{
  margin:0;
  font-size:14px;
}
#tooltip{
  background:rgba(0,0,0,1);
  border:1px solid grey;
  border-radius:5px;
  font-size:12px;
  width:auto;
  padding:4px;
  color:white;
  opacity:0;
}
#tooltip table{
  table-layout:fixed;
}
#tooltip tr td{
  padding:0;
  margin:0;
}
#tooltip tr td:nth-child(1){
  width:50px;
}
#tooltip tr td:nth-child(2){
  text-align:center;
}

</style>

</head>
<body>
<script>

function tooltipHtml(n, d){
    return "<h4>"+n+"</h4><table>"+
    "<tr><td>Dem</td><td>"+(d.dem)+"</td></tr>"+
    "<tr><td>Rep</td><td>"+(d.rep)+"</td></tr>"+
    "<tr><td>Other</td><td>"+(d.oth)+"</td></tr>"+
    "</table>";
}

$.ajax({
  url:"https://raw.githubusercontent.com/TimeMagazine/presidential-election-results/master/data/results_2012.json",
  dataType:"text",
  success:function(data){
    var states ={};
    var json = $.parseJSON(data)
    $.each(Object.values(json), function(state, results) {
      var republican = 0;
      var democratic = 0 ;
      var other = 0 ;

      $.each(Object.values(results), function(key,value){
      if(value.parties.toString().includes("Republican")){
        republican+= value.votes
        }
      else if(value.parties.toString().includes("Democratic")){
        democratic+=value.votes
      }
      else{
        other+=value.votes
      }
    })

      var d=Object.values(Object.values(results))[0].abbr
      if(republican>democratic && republican>other){
        states[d]= {dem:democratic, rep:republican, oth:other,color:"#8B0000",abbr:d}
      }
      else if(democratic>republican && democratic>other) {
       states[d]= {dem:democratic, rep:republican, oth:other,color:"#00008B",abbr:d}
      }
      else if(other>republican && other>democratic){
states[d]= {dem:democratic, rep:republican, oth:other,color:"#FFD700",abbr:d}

}
    })

uStates.draw("#statesvg", states, tooltipHtml);
d3.select(self.frameElement).style("height", "800px");
  }
});
</script>
</body>
</html>
